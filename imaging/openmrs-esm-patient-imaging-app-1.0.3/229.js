"use strict";(globalThis.webpackChunk_openmrs_openmrs_esm_patient_imaging_app=globalThis.webpackChunk_openmrs_openmrs_esm_patient_imaging_app||[]).push([[229],{2610:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(6072),i=n.n(r),a=n(3941),o=n(5987),s=n(3453),c=n(8871),l=n(1186),u=n(1145),m=n(9785),d=n(9530),p=n(1201),h=n(6067);function v(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}const f=function(e){var t=e.patientUuid,n=e.closeWorkspace,f=e.closeWorkspaceWithSavedChanges,g=e.promptBeforeClosing,y=(0,a.useTranslation)().t,b="tablet"===(0,o.useLayoutType)(),E=(0,d.E5)(),q=(0,d.sN)(t).mutate,C=(0,r.useMemo)(function(){return s.Ik({id:s.ai().nullable().optional(),orthancConfiguration:s.Ik({id:s.ai(),orthancBaseUrl:s.Yj(),orthancProxyUrl:s.Yj().nullable().optional()}),accessionNumber:s.Yj().nonempty({message:y("accessNumberWarn","Accession number is required")}),requestingPhysician:s.Yj().refine(function(e){return!!e},{message:y("requestingPhysicianMsg","Enter the requesting physician name")}),requestDescription:s.Yj().refine(function(e){return!!e},{message:y("requestDescriptionMsg","Enter the request description")}),priority:s.Yj().min(1,{message:y("priorityWarn","Priority is required")})})},[y]),x=(0,m.mN)({mode:"all",resolver:(0,c.u)(C)}),k=x.control,w=x.handleSubmit,P=x.formState,N=P.errors,S=P.isDirty,T=P.isSubmitting;(0,r.useEffect)(function(){g(function(){return S})},[S,g]);var A=(0,r.useCallback)(function(e){return(n=function(){var n,r,i;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(a){switch(a.label){case 0:n=new AbortController,r={orthancConfiguration:{id:e.orthancConfiguration.id,orthancBaseUrl:e.orthancConfiguration.orthancBaseUrl,orthancProxyUrl:e.orthancConfiguration.orthancProxyUrl},patientUuid:t,accessionNumber:e.accessionNumber,requestingPhysician:e.requestingPhysician,requestDescription:e.requestDescription,priority:e.priority},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(0,d.MO)(r,t,n)];case 2:return a.sent(),q(),f(),(0,o.showSnackbar)({kind:"success",title:y("requestSaved","Request saved successfully")}),[3,4];case 3:return i=a.sent(),(0,o.showSnackbar)({title:y("errorSavingRequest","An error occurred while saving the request procedure"),kind:"error",subtitle:null==i?void 0:i.message,isLowContrast:!1}),[3,4];case 4:return[2]}})},function(){var e=this,t=arguments;return new Promise(function(r,i){var a=n.apply(e,t);function o(e){v(a,r,i,o,s,"next",e)}function s(e){v(a,r,i,o,s,"throw",e)}o(void 0)})})();var n},[t,f,y,q]);return i().createElement(m.Op,x,i().createElement(l.lVW,{className:h.A.form,id:"newRequestForm",onSubmit:w(A)},i().createElement(l.BJc,{gap:1,className:h.A.container},i().createElement("section",null,i().createElement(o.ResponsiveWrapper,null,i().createElement(l.gE_,{legendText:y("orthancConfiguration","Orthanc configurations")},i().createElement(m.xI,{name:"orthancConfiguration",control:k,render:function(e){var t,n=e.field,r=n.value,a=n.onChange;return i().createElement(l.a32,{id:"orthancConfiguration",itemToString:function(e){return null==e?void 0:e.orthancBaseUrl},items:E.data||[],onChange:function(e){var t=e.selectedItem;return a(t)},placeholder:y("selectOrthancServer","Select an Orthanc server"),selectedItem:r,invalid:!!N.orthancConfiguration,invalidText:(null===(t=N.orthancConfiguration)||void 0===t?void 0:t.message)||y("selectValidServer","Please select a valid Orthanc server")})}})))),i().createElement("section",null,i().createElement(o.ResponsiveWrapper,null,i().createElement(m.xI,{name:"accessionNumber",control:k,render:function(e){var t,n=e.field,r=n.onChange,a=n.value;return i().createElement("div",{className:"div",style:{display:"flex"}},i().createElement(l.ksK,{type:"text",id:"accessionNumber","data-testid":"accessionNumber",labelText:y("accessionNumber","Accession Number"),value:a,onChange:function(e){return r(e.target.value)},invalid:!!N.accessionNumber,invalidText:(null===(t=N.accessionNumber)||void 0===t?void 0:t.message)||y("enterAccessionNumber","Please enter the accession number")}),i().createElement(l.$nd,{type:"button",onClick:function(){return r((0,p.DO)())},style:{width:"15px"}},"Generate number"))}}))),i().createElement("section",null,i().createElement(o.ResponsiveWrapper,null,i().createElement(m.xI,{name:"requestingPhysician",control:k,render:function(e){var t,n=e.field,r=n.onChange,a=n.value;return i().createElement("div",{className:h.A.row},i().createElement(l.ksK,{type:"text",id:"requestingPhysician",labelText:y("requestingPhysician","Physician"),value:a,onChange:function(e){return r(e.target.value)},invalid:!!N.requestingPhysician,invalidText:(null===(t=N.requestingPhysician)||void 0===t?void 0:t.message)||y("enterRequestingPhysician","Please enter the physician name")}))}}))),i().createElement("section",null,i().createElement(o.ResponsiveWrapper,null,i().createElement(m.xI,{name:"requestDescription",control:k,render:function(e){var t,n=e.field,r=n.onChange,a=n.value;return i().createElement("div",{className:h.A.row},i().createElement(l.fs1,{type:"text",id:"requestDescription",labelText:y("requestDescription","Request procedure description"),value:a,onChange:function(e){return r(e.target.value)},invalid:!!(null==N?void 0:N.requestDescription),invalidText:(null==N||null===(t=N.requestDescription)||void 0===t?void 0:t.message)||y("enterRequestDescription","Please enter the request procedure description")}))}}))),i().createElement("section",null,i().createElement(o.ResponsiveWrapper,null,i().createElement(l.gE_,{legendText:y("priority","priority")},i().createElement(m.xI,{name:"priority",control:k,defaultValue:"low",render:function(e){var t,n=e.field,r=n.value,a=n.onChange;return i().createElement(l.a32,{id:"priority",itemToString:function(e){return e},items:u.wk,onChange:function(e){var t=e.selectedItem;return a(t)},placeholder:y("selectPriority","Select the request priority"),selectedItem:r,invalid:!!N.priority,invalidText:(null===(t=N.priority)||void 0===t?void 0:t.message)||y("selectPriority","Select the request priority")})}}))))),i().createElement(l.Te$,{className:b?h.A.tabletButtons:h.A.desktopButtons},i().createElement(l.$nd,{className:h.A.button,onClick:function(){return n()},kind:"secondary"},y("discard","Discard")),i().createElement(l.$nd,{className:h.A.button,kind:"primary",disabled:T,type:"submit"},T?i().createElement(l.OuH,{description:y("saving","Saving")+"..."}):y("saveAndClose","Save and Close")))))}}}]);