"use strict";(globalThis.webpackChunk_zhaosadre_esm_patient_imaging_app=globalThis.webpackChunk_zhaosadre_esm_patient_imaging_app||[]).push([[507],{9507:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r(6072),a=r.n(n),i=r(3941),l=r(5987),o=r(1186),c=r(9530),s=r(9785),u=r(1145),d=r(3453),m=r(8871),p=r(6067),f=r(1201);function v(e,t,r,n,a,i,l){try{var o=e[i](l),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const y=function(e){var t=e.patientUuid,r=e.request,y=e.closeWorkspace,h=e.closeWorkspaceWithSavedChanges,b=e.promptBeforeClosing,S=(0,i.useTranslation)().t,E="tablet"===(0,l.useLayoutType)(),T=(0,c.Hu)(r.id).mutate,P=(0,c.sN)(t).mutate,x=(0,n.useMemo)(function(){return d.Ik({modality:d.Yj().min(1,{message:S("modalityRequiredWarn","Modality is required")}),aetTitle:d.Yj().min(1,{message:S("aetTitleWarn","AET title is required")}),scheduledReferringPhysician:d.Yj().refine(function(e){return!!e},{message:S("scheduledReferringPhysicianWarn","Referring physician is required")}),requestedProcedureDescription:d.Yj().refine(function(e){return!!e},{message:S("requestedProcedureDescriptionWarn","Procedure description is required")}),stepStartDate:d.p6().refine(function(e){return!!e},S("stepDateWarn","Step date is required")),stepStartTime:d.Yj().refine(function(e){return!!e},S("stepTimeWarn","Step start time is required")),timeFormat:d.Yj().refine(function(e){return!!e},S("seletTimeFormatWarn","Time format is required")),stationName:d.Yj().nullable().optional(),procedureStepLocation:d.Yj().nullable().optional()})},[S]),w=(0,s.mN)({mode:"all",resolver:(0,m.u)(x)}),D=w.control,k=w.handleSubmit,O=w.getValues,q=w.setValue,C=w.formState,j=C.errors,R=C.isDirty,A=C.isSubmitting;(0,n.useEffect)(function(){b(function(){return R})},[R,b]),(0,n.useEffect)(function(){q("timeFormat","AM")},[q]),(0,n.useEffect)(function(){q("modality",u.sf[0].code)},[q]);var N=(0,n.useCallback)(function(e){return(t=function(){var t,n,a,i,o,s,u;return function(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=o(0),l.throw=o(1),l.return=o(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}(this,function(d){switch(d.label){case 0:t=new AbortController,n=O("stepStartTime"),a=O("timeFormat"),i=(0,f.yc)(n,a),o=r.id,s={requestId:o,modality:e.modality,aetTitle:e.aetTitle,scheduledReferringPhysician:e.scheduledReferringPhysician,requestedProcedureDescription:e.requestedProcedureDescription,stepStartDate:(0,f.Rs)(e.stepStartDate),stepStartTime:i,stationName:e.stationName?e.stationName:null,procedureStepLocation:e.procedureStepLocation?e.procedureStepLocation:null},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,(0,c.mg)(s,o,t)];case 2:return d.sent(),T(),h(),(0,l.showSnackbar)({kind:"success",title:S("procedureStepSaved","Procedure step is saved successfully")}),P(),[3,4];case 3:return u=d.sent(),(0,l.showSnackbar)({title:S("errorSavingProcedureStep","An error occurred while saving the procedure step"),kind:"error",subtitle:null==u?void 0:u.message,isLowContrast:!1}),[3,4];case 4:return[2]}})},function(){var e=this,r=arguments;return new Promise(function(n,a){var i=t.apply(e,r);function l(e){v(i,n,a,l,o,"next",e)}function o(e){v(i,n,a,l,o,"throw",e)}l(void 0)})})();var t},[r,h,S,T,P,O]);return a().createElement(s.Op,w,a().createElement(o.lVW,{className:p.A.form,onSubmit:k(N),id:"newRequestStepForm"},a().createElement(o.BJc,{gap:1,className:p.A.container},a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(o.gE_,{legendText:S("modality","Modality")},a().createElement(s.xI,{name:"modality",control:D,render:function(e){var t,r=e.field,n=r.value,i=r.onChange;return a().createElement("div",{className:p.A.row},a().createElement(o.a32,{id:"modality","data-testid":"modality",itemToString:function(e){return(null==e?void 0:e.label)||""},items:u.sf,onChange:function(e){var t=e.selectedItem;return i(null==t?void 0:t.code)},placeholder:S("selectModality","Select the modality"),"aria-label":S("modality","Modality"),selectedItem:u.sf.find(function(e){return e.code===n}),invalid:!!(null==j?void 0:j.modality),invalidText:(null==j||null===(t=j.modality)||void 0===t?void 0:t.message)||S("modalityRequiredWarn","Modality is required")}))}})))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"aetTitle",control:D,render:function(e){var t,r=e.field,n=r.onChange,i=r.value;return a().createElement("div",{className:p.A.row},a().createElement(o.ksK,{type:"text",id:"aetTitle",labelText:S("aetTitle","AetTitle"),value:i,onChange:function(e){return n(e.target.value)},invalid:!!(null==j?void 0:j.aetTitle),invalidText:(null==j||null===(t=j.aetTitle)||void 0===t?void 0:t.message)||S("aetTitleWarn","Aet Title is required")}))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"scheduledReferringPhysician",control:D,render:function(e){var t,r=e.field,n=r.onChange,i=r.value;return a().createElement("div",{className:p.A.row},a().createElement(o.ksK,{type:"text",id:"scheduledReferringPhysician",labelText:S("scheduledReferringPhysician","scheduledReferringPhysician"),value:i,onChange:function(e){return n(e.target.value)},invalid:!!(null==j?void 0:j.scheduledReferringPhysician),invalidText:(null==j||null===(t=j.scheduledReferringPhysician)||void 0===t?void 0:t.message)||S("enterScheduledReferringPhysician","Scheduled referring physician is required")}))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"requestedProcedureDescription",control:D,render:function(e){var t,r=e.field,n=r.onChange,i=r.value;return a().createElement("div",{className:p.A.row},a().createElement(o.fs1,{type:"text",id:"requestedProcedureDescription",labelText:S("description","Description"),value:i,onChange:function(e){return n(e.target.value)},invalid:!!(null==j?void 0:j.requestedProcedureDescription),invalidText:(null==j||null===(t=j.requestedProcedureDescription)||void 0===t?void 0:t.message)||S("enterDescription","Description is required")}))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"stepStartDate",control:D,render:function(e){var t,r,n,i,o=e.field,c=e.fieldState;return a().createElement(l.OpenmrsDatePicker,(n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){g(e,t,r[t])})}return e}({},o),i=null!=(i={id:"stepStartDate","data-testid":"stepStartDate",maxDate:new Date,style:{paddingBottom:"1rem",width:"100%"},labelText:S("stepStartDate","StepStartDate"),invalid:Boolean(null==c||null===(t=c.error)||void 0===t?void 0:t.message),invalidText:(null==c||null===(r=c.error)||void 0===r?void 0:r.message)||S("selectStepStartDate","Start date is required")})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}),n))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"stepStartTime",control:D,render:function(e){var t,r=e.field,n=r.onBlur,i=r.onChange,l=r.value;return a().createElement(o.AG,{id:"stepStartTime","data-testid":"stepStartTime",labelText:S("startTime","Start time"),onChange:function(e){return i(e.target.value)},pattern:"^(1[0-2]|0?[1-9]):([0-5]?[0-9])$",style:{marginLeft:"0.125rem",flex:"none"},value:l,onBlur:n,invalid:!!(null==j?void 0:j.stepStartTime),invalidText:(null==j||null===(t=j.stepStartTime)||void 0===t?void 0:t.message)||S("selectStepStartTime","Start time is required")},a().createElement(s.xI,{name:"timeFormat",control:D,render:function(e){var t=e.field,r=t.onChange,n=t.value;return a().createElement(o.E_7,{id:"timeFormatSelect",onChange:function(e){return r(e.target.value)},value:n,"aria-label":S("timeFormat ","Time Format")},a().createElement(o.ebT,{value:"AM",text:S("AM","AM")}),a().createElement(o.ebT,{value:"PM",text:S("PM","PM")}))}}))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"stationName",control:D,render:function(e){var t=e.field,r=t.onChange,n=t.value;return a().createElement("div",{className:p.A.row},a().createElement(o.ksK,{type:"text",id:"stationName",labelText:S("stationName","stationName"),value:n,onChange:function(e){return r(e.target.value)}}))}}))),a().createElement("section",null,a().createElement(l.ResponsiveWrapper,null,a().createElement(s.xI,{name:"procedureStepLocation",control:D,render:function(e){var t=e.field,r=t.onChange,n=t.value;return a().createElement("div",{className:p.A.row},a().createElement(o.ksK,{type:"text",id:"procedureStepLocation",labelText:S("procedureStepLocation","procedureStepLocation"),value:n,onChange:function(e){return r(e.target.value)}}))}})))),a().createElement(o.Te$,{className:E?p.A.tabletButtons:p.A.desktopButtons},a().createElement(o.$nd,{className:p.A.button,kind:"secondary",onClick:function(){return y()}},S("discard","Discard")),a().createElement(o.$nd,{className:p.A.button,kind:"primary",disabled:A,type:"submit"},A?a().createElement(o.OuH,{description:S("saving","Saving")+"..."}):S("saveAndClose","Save and Close")))))}}}]);